version: "3.9"

services:
  # SERVICIO 1: HADOOP
  hadoop:
    build:
      context: ./hadoop
    container_name: hadoop
    hostname: hadoop
    # Mapeo de puertos para acceder a las interfaces web (opcional)
    ports:
      - "9870:9870"   # NameNode UI
      - "9864:9864"   # DataNode UI
      - "8032:8032"   # ResourceManager
      - "9000:9000"   # HDFS
      - "22:22"
    networks:
      - bigdata
    volumes:
      # Montar un volumen para persistir los datos HDFS
      - hdfs:/usr/local/hadoop/hadoop_storage

  # SERVICIO 2: BASE DE DATOS MySQL
  mysql:
    image: mysql:8
    container_name: mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: testdb
    ports:
      - "3306:3306"
    networks:
      - bigdata

  # SERVICIO 3: SQOOP
  sqoop:
    build:
      context: ./sqoop
    container_name: sqoop
    depends_on:
      - hadoop
      - mysql
    environment:
      - JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
      - HADOOP_CONF_DIR=/usr/local/hadoop/etc/hadoop
    networks:
      - bigdata
    volumes:
      - ./hadoop/conf:/usr/local/hadoop/etc/hadoop

  flume:
    build:
      context: ./flume
    container_name: flume
    depends_on:
      - hadoop
    networks:
      - bigdata
    volumes:
      - ./flume/flume.conf:/opt/flume/conf/flume.conf
      - ./flume/logs:/opt/logs

# VOLÃšMENES Y REDES
networks:
  bigdata:
    driver: bridge

volumes:
  hdfs:
